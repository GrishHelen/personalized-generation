# personalized-generation
## Курсовой проект по теме "Исследование методов персонализированной генерации с помощью диффузионных моделей", 3 курс (2024-25)

### Аннотация

Персонализированная генерация изображений — активно развивающееся направление в области компьютерного зрения, позволяющее создавать консистентные визуальные представления объектов в разнообразных контекстах на основе текстовых описаний или референсных фотографий. Однако существующие методы сталкиваются с рядом ограничений: высокой вычислительной сложностью, снижением качества при работе со специфичными доменами и недостаточной гибкостью в адаптации к пользовательским запросам.

Целью данной работы является разработка нового метода, направленного на устранение указанных проблем. Основная задача заключается в обеспечении высокой степени визуальной согласованности объектов (сохранение формы, текстуры, цветовой палитры) между сгенерированными изображениями при их естественном интегрировании в разнообразные сцены. Также планируется провести экспериментальный анализ качества предложенного подхода и его сравнение с современными методами. 

### Воспроизведение основных бейзлайнов

В качестве основного бейзлайна в данной работе рассматривается метод [Consistory](https://github.com/NVlabs/consistory.git). 

#### Примеры работы ConsiStory
В ходе проведенного исследования были проанализированы результаты бейзлайна. В частности, было отобрано 10 примеров успешной работы метода ConsiStory, демонстрирующих высокую степень согласованности внешнего вида объекта в различных сценах. Также были выявлены 10 случаев, в которых ConsiStory показал недостаточное качество. В этих примерах наблюдаются значительные расхождения во внешнем виде объекта на сгенерированных изображениях. Примеры хорошей и плохой работы редота представлены на рисунке ниже.

![Coursework_3year(кт-1)_page-0008](https://github.com/user-attachments/assets/3a570262-4721-4a21-a06f-b90b37a6d170)

Эксперименты показали, что метод как правило демонстрирует высокое качество при генерации изображений с животными (например, если объектом являются леопард или дельфин), сохраняя консистентность их визуальных особенностей между изображениями в различных сценах. Однако для неодушевленных объектов (автобус, коробка) зачастую наблюдается снижение стабильности: их внешний вид варьируется в зависимости от контекста.

#### Влияние гиперпараметров на работу метода

Было проведено исследование влияния ключевых параметров ConsiStory и его частей на соответствие сгенерированных изображений текстовым промптам, качество генерации объектов и их консистентность между картинками. Так, метод имеет 3 основных параметра, влияющих на качество генерации объекта и сохранение его визуальных особенностей: 
- same_latent (default: False). Определяет, из одного ли шумового вектора генерируется серия изображений одного объекта в различных сценах.
- perform_sdsa (default: True). Управляет активацией компоненты метода, реализующей идею SDSA.
- perform_injection (default: True). При включении данного параметра реализуется идея Feature Injection, направленного на дополнительное повышение идентичности внешнего вида объекта на сгенерированных изображениях.

Еще 3 параметра позволяют контролировать вариативность внешнего вида объекта на изображениях (позы, ракурс): 
- share_queries (default: True). Показывает, будет ли применяться взвешенное комбинирование матриц Q из механизма SDSA и стандартного self-attention путем их взвешенного суммирования.
- mask_dropout (default: 0.5). Определяет долю патчей, зануляемых в маске, используемой в SDSA. Уменьшение значения данного параметра усиливает консистентность особенностей внешнего вида объекта, но значительно снижает разнообразие поз и ракурсов.
- n_anchors (default: 2). Отвечает за количество `якорных' изображений, используемых в компонентах SDSA и feature injection для повышения консистентности внешнего вида объекта в различных сценах.

Авторы метода отмечают, что SDSA является ключевой составляющей метода и оказывает наибольшее влияние на идентичность объекта в различных сценах, что подтверждается проведенными экспериментами. Параметр ``perform_sdsa`` (default: True) управляет активацией данной компоненты метода. Обмен информацией между матрицами механизма внимания повышает консистентность изображений, а если параметр отключен (perform_sdsa=False), то при генерации изображений реализуется стандартный self-attention, что приводит к снижению похожести объектов. 

#### Анализ недостатков бейзлайна и возможных улучшений метода

Одним из ключевых недостатков ConsiStory является зависимость его ключевого компонента (SDSA) от точности локализации объекта в изображении. В случае нетипичных объектов это может приводить к усилению расхождений во внешнем виде объектов. В данной работе предполагается преодолеть эту проблему и усовершенствовать метод, предложив другой способ модифицировать стандартный self-attention для повышения консистентности объекта на различных изображениях.
